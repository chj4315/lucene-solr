<!--
Maven settings file to point at a specific GBN.

To build your CDH component against a specific
Global Build Number (GBN), use this Maven
settings file with "mvn -gs settings.xml" and
the environment variable CDH_GBN=... and CM_GBN=... set.

For example, to build against the latest build,

$ export CDH_GBN=$(curl 'http://mostrows-builddb.vpc.cloudera.com:8080/query?product=cdh&version=6.x')
$ export CM_GBN=$(curl 'http://mostrows-builddb.vpc.cloudera.com:8080/query?product=cm&version=6.x.0')
$ mvn -gs setings.xml install

This file shares some implementation with
the Cauldron local-build-m2-settings.xml settings
file, which uses a file-based repo.
-->
<settings>
  <mirrors>
    <!--
        Cauldron repo is a virtual Artifactory repo which should serve the
        necessary artifacts to perform a complete build. The special
        property of the cauldron repo though is the inability to resolve
        any -SNAPSHOT artifacts, e.g.
        org.apache.hadoop:hadoop-client:jar:2.6.0-mr1-cdh5.8.0-SNAPSHOT.

        This prevents the build from picking up any leaked artifacts.
    -->
    <mirror>
      <mirrorOf>external:*,!cdh.repo,!cm.repo</mirrorOf>
      <name>cauldron-repo</name>
      <url>http://maven.jenkins.cloudera.com:8081/artifactory/cauldron-repo</url>
      <id>cauldron-repo</id>
    </mirror>

    <mirror>
      <mirrorOf>external:*,!cdh.repo,!cm.repo</mirrorOf>
      <name>cauldron-repo</name>
      <url>http://maven.jenkins.cloudera.com:8081/artifactory/repo1-cache</url>
      <id>repo1-cache</id>
    </mirror>
  </mirrors>

  <profiles>
    <profile>
      <id>gbn-build</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <properties>
        <repository.root>http://cloudera-build-us-west-1.vpc.cloudera.com/s3/build/${env.CDH_GBN}/cdh6/6.x/maven-repository/</repository.root>
      </properties>
      <repositories>
        <repository>
          <id>cdh.repo</id>
          <url>http://cloudera-build-us-west-1.vpc.cloudera.com/s3/build/${env.CDH_GBN}/cdh6/6.x/maven-repository/</url>
          <name>Cauldron Build GBN Artifacts Repository</name>
          <snapshots>
            <enabled>true</enabled>
          </snapshots>
          <releases>
            <enabled>true</enabled>
          </releases>
        </repository>

        <repository>
          <id>cm.repo</id>
          <url>http://cloudera-build-us-west-1.vpc.cloudera.com/s3/build/${env.CM_GBN}/generic/maven</url>
          <name>Cauldron Build GBN Artifacts Repository for CM</name>
          <snapshots>
            <enabled>true</enabled>
          </snapshots>
          <releases>
            <enabled>true</enabled>
          </releases>
        </repository>

        <repository>
          <id>external</id>
          <url>http://maven.jenkins.cloudera.com:8081/artifactory/cauldron-repo</url>
          <name>External artifacts</name>
          <snapshots>
            <enabled>true</enabled>
          </snapshots>
          <releases>
            <enabled>true</enabled>
          </releases>
        </repository>

      </repositories>
      <!-- We define plugin repositories same as regular repositories, since we build
           at least one plugin. (avro-maven-plugin) -->
      <pluginRepositories>
        <pluginRepository>
          <id>cdh.repo</id>
          <url>http://cloudera-build-us-west-1.vpc.cloudera.com/s3/build/${env.CDH_GBN}/cdh6/6.x/maven-repository/</url>
          <name>Cauldron Build GBN Artifacts Repository</name>
          <snapshots>
            <enabled>true</enabled>
          </snapshots>
          <releases>
            <enabled>true</enabled>
          </releases>
        </pluginRepository>

        <pluginRepository>
          <id>external</id>
          <url>http://maven.jenkins.cloudera.com:8081/artifactory/cauldron-repo</url>
          <name>External artifacts</name>
          <snapshots>
            <enabled>true</enabled>
          </snapshots>
          <releases>
            <enabled>true</enabled>
          </releases>
        </pluginRepository>

      </pluginRepositories>
    </profile>
  </profiles>
  <activeProfiles>
    <activeProfile>gbn-build</activeProfile>
  </activeProfiles>
</settings>
